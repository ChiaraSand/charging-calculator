<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>E-Auto Ladekosten Rechner & Tarifvergleich</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <header class="header">
        <div class="header-content">
          <h1>
            <i class="fas fa-charging-station"></i> E-Auto Ladekosten Rechner
          </h1>
          <p class="subtitle">
            Vergleiche Ladetarife und finde die günstigsten Ladesäulen in deiner
            Nähe
          </p>
        </div>
      </header>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Calculator Section -->
        <section class="calculator-section">
          <div class="card">
            <div class="card-header">
              <h2><i class="fas fa-calculator"></i> Ladedauer berechnen</h2>
              <div class="form-actions">
                <button type="button" id="clearAll" class="btn btn-secondary">
                  <i class="fas fa-eraser"></i> Alle Felder leeren
                </button>
              </div>
            </div>

            <form id="chargingForm" class="calculator-form">
              <div class="form-grid">
                <div class="form-group">
                  <label for="batteryCapacity">Batteriekapazität (kWh)</label>
                  <div class="input-with-clear">
                    <input
                      type="number"
                      id="batteryCapacity"
                      name="batteryCapacity"
                      value="52"
                      min="1"
                      max="200"
                      step="0.1"
                    />
                    <button
                      type="button"
                      class="clear-btn"
                      data-target="batteryCapacity"
                      title="Löschen"
                    >
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
                <div class="form-group">
                  <label for="vehicleSelect">Fahrzeug-Modell</label>
                  <select id="vehicleSelect" name="vehicleSelect">
                    <option value="renault-5-e-tech-52kwh" selected>
                      Renault 5 E-Tech 52 kWh
                    </option>
                    <option value="generic">Allgemeines Fahrzeug</option>
                  </select>
                  <small class="form-help"
                    >Wählen Sie Ihr Fahrzeug für präzise Ladekurven</small
                  >
                </div>

                <div class="form-group">
                  <label for="currentCharge">Aktueller Ladestand (%)</label>
                  <div class="range-with-clear">
                    <input
                      type="range"
                      id="currentCharge"
                      name="currentCharge"
                      value="20"
                      min="0"
                      max="100"
                      step="1"
                    />
                    <span class="range-value" id="currentChargeValue">20%</span>
                    <button
                      type="button"
                      class="clear-btn range-clear-btn"
                      data-target="currentCharge"
                      title="Löschen"
                    >
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>

                <div class="form-group">
                  <label for="targetCharge">Ziel-Ladestand (%)</label>
                  <div class="range-with-clear">
                    <input
                      type="range"
                      id="targetCharge"
                      name="targetCharge"
                      value="80"
                      min="0"
                      max="100"
                      step="1"
                    />
                    <span class="range-value" id="targetChargeValue">80%</span>
                    <button
                      type="button"
                      class="clear-btn range-clear-btn"
                      data-target="targetCharge"
                      title="Löschen"
                    >
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>

                <div class="form-group">
                  <label for="chargingPower">Ladeleistung (kW)</label>
                  <select id="chargingPower" name="chargingPower">
                    <option value="3.7">AC 3,7 kW (Haushaltssteckdose)</option>
                    <option value="11">AC 11 kW (Wallbox)</option>
                    <option value="22" selected>AC 22 kW (Wallbox)</option>
                    <option value="50">DC 50 kW (Schnelllader)</option>
                    <option value="150">DC 150 kW (Hochleistungslader)</option>
                    <option value="300">DC 300 kW (Ultra-Schnelllader)</option>
                  </select>
                </div>
                <!-- <div class="form-group-double"> -->
                <div class="form-group">
                  <label for="startTime">Parken Beginn</label>
                  <div class="input-with-clear">
                    <input
                      type="time"
                      id="startTime"
                      name="startTime"
                      value="--:--"
                    />
                    <button
                      type="button"
                      class="clear-btn"
                      data-target="startTime"
                      title="Löschen"
                    >
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>

                <div class="form-group">
                  <label for="endTime">Parken Ende</label>
                  <div class="input-with-clear">
                    <input
                      type="time"
                      id="endTime"
                      name="endTime"
                      value="--:--"
                    />
                    <button
                      type="button"
                      class="clear-btn"
                      data-target="endTime"
                      title="Löschen"
                    >
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
                <!-- </div> -->
              </div>
              <div id="vehicle-details"></div>

              <div class="calculation-summary">
                <div class="summary-item">
                  <span class="label">Zu ladende Energie:</span>
                  <span class="value" id="energyToCharge"></span>
                </div>
                <div class="summary-item">
                  <span class="label">Geschätzte Ladezeit:</span>
                  <span class="value" id="estimatedTime"></span>
                </div>
                <div class="summary-item">
                  <span class="label">Gesamte Parkzeit:</span>
                  <span class="value" id="totalParkingTime"></span>
                </div>
              </div>
            </form>
          </div>
        </section>

        <!-- Charging Level Graph Section -->
        <section class="graph-section">
          <div class="card">
            <h2><i class="fas fa-chart-line"></i> Ladeverlauf</h2>
            <div class="graph-container">
              <div class="graph-info">
                <p class="graph-description">
                  Realistische Darstellung des Ladeverlaufs basierend auf
                  Batteriekapazität und Ladeleistung. Die Grafik zeigt
                  verschiedene Ladeleistungen im Vergleich - von der
                  Haushaltssteckdose bis zum Ultra-Schnelllader.
                </p>
              </div>
              <div class="chart-wrapper">
                <canvas
                  id="chargingLevelChart"
                  width="800"
                  height="400"
                ></canvas>
              </div>
              <div class="graph-legend">
                <div class="legend-header">
                  <h4>Ladekurven anzeigen/ausblenden</h4>
                  <div class="legend-controls">
                    <button
                      type="button"
                      id="showAllCurves"
                      class="btn btn-sm btn-secondary"
                    >
                      <i class="fas fa-eye"></i> Alle anzeigen
                    </button>
                    <button
                      type="button"
                      id="hideAllCurves"
                      class="btn btn-sm btn-secondary"
                    >
                      <i class="fas fa-eye-slash"></i> Alle ausblenden
                    </button>
                  </div>
                </div>
                <div class="legend-items">
                  <div class="legend-item active" data-dataset="0">
                    <div class="legend-color" style="background: #2563eb"></div>
                    <span>Ladeverlauf (realistisch)</span>
                    <button
                      type="button"
                      class="legend-toggle"
                      data-dataset="0"
                    >
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                  <div class="legend-item active" data-dataset="1">
                    <div class="legend-color" style="background: #10b981"></div>
                    <span>Lineare Schätzung</span>
                    <button
                      type="button"
                      class="legend-toggle"
                      data-dataset="1"
                    >
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                  <div class="legend-item active" data-dataset="2">
                    <div class="legend-color" style="background: #dc2626"></div>
                    <span>400 kW (Ultra-Schnelllader)</span>
                    <button
                      type="button"
                      class="legend-toggle"
                      data-dataset="2"
                    >
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                  <div class="legend-item active" data-dataset="3">
                    <div class="legend-color" style="background: #f59e0b"></div>
                    <span>300 kW (Hochleistungslader)</span>
                    <button
                      type="button"
                      class="legend-toggle"
                      data-dataset="3"
                    >
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                  <div class="legend-item active" data-dataset="4">
                    <div class="legend-color" style="background: #8b5cf6"></div>
                    <span>150 kW (Schnelllader)</span>
                    <button
                      type="button"
                      class="legend-toggle"
                      data-dataset="4"
                    >
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                  <div class="legend-item active" data-dataset="5">
                    <div class="legend-color" style="background: #06b6d4"></div>
                    <span>50 kW (DC Schnelllader)</span>
                    <button
                      type="button"
                      class="legend-toggle"
                      data-dataset="5"
                    >
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                  <div class="legend-item active" data-dataset="6">
                    <div class="legend-color" style="background: #84cc16"></div>
                    <span>22 kW (AC Wallbox)</span>
                    <button
                      type="button"
                      class="legend-toggle"
                      data-dataset="6"
                    >
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                  <div class="legend-item active" data-dataset="7">
                    <div class="legend-color" style="background: #f97316"></div>
                    <span>11 kW (AC Wallbox)</span>
                    <button
                      type="button"
                      class="legend-toggle"
                      data-dataset="7"
                    >
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Provider Filter Section -->
        <section class="filter-section">
          <div class="card">
            <h2><i class="fas fa-filter"></i> Filter</h2>
            <div class="filter-tabs">
              <button class="filter-tab active" data-tab="providers">
                <i class="fas fa-building"></i> Anbieter
              </button>
              <button class="filter-tab" data-tab="connectors">
                <i class="fas fa-plug"></i> Steckertypen
              </button>
            </div>

            <!-- Provider Filter Tab -->
            <div class="filter-content active" id="providers-tab">
              <div class="provider-filters">
                <div class="filter-group">
                  <label>Ladetarife anzeigen:</label>
                  <div class="checkbox-grid" id="providerCheckboxes">
                    <!-- Will be populated by JavaScript -->
                  </div>
                </div>
                <div class="filter-actions">
                  <button
                    type="button"
                    id="selectAll"
                    class="btn btn-secondary"
                  >
                    Alle auswählen
                  </button>
                  <button
                    type="button"
                    id="selectNone"
                    class="btn btn-secondary"
                  >
                    Alle abwählen
                  </button>
                </div>
              </div>
            </div>

            <!-- Connector Filter Tab -->
            <div class="filter-content" id="connectors-tab">
              <div class="connector-filters">
                <div class="filter-group">
                  <label>Steckertypen anzeigen:</label>
                  <div class="checkbox-grid" id="connectorCheckboxes">
                    <!-- Will be populated by JavaScript -->
                  </div>
                </div>
                <div class="filter-actions">
                  <button
                    type="button"
                    id="selectAllConnectors"
                    class="btn btn-secondary"
                  >
                    Alle auswählen
                  </button>
                  <button
                    type="button"
                    id="selectNoConnectors"
                    class="btn btn-secondary"
                  >
                    Alle abwählen
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Tariff Comparison Section -->
        <section class="comparison-section">
          <div class="card">
            <h2><i class="fas fa-chart-bar"></i> Tarifvergleich</h2>
            <div class="table-container">
              <table id="tariffTable" class="tariff-table">
                <thead>
                  <tr>
                    <th>Anbieter</th>
                    <!-- <th>Ladeleistung (kW)</th> -->
                    <th>€/kWh</th>
                    <!-- <th>Grundgebühr</th> -->
                    <th>Blocking Fee (Tarif)</th>
                    <th>
                      Ladekosten Total <br />
                      <small>(<span id="pricePerSelectedKwh">kWh</span>)</small>
                    </th>
                    <th>Blocking Fee Total</th>
                    <th>Gesamtkosten</th>
                    <th>Effektiv €/kWh</th>
                  </tr>
                </thead>
                <tbody id="tariffTableBody">
                  <tr>
                    <td colspan="8" class="loading-cell">
                      <i class="fas fa-spinner fa-spin"></i> Lade Tarifdaten...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Map Section -->
        <div id="maps-section"></div>
      </main>

      <!-- Footer -->
      <footer class="footer">
        <p>
          &copy; 2025 E-Auto Ladekosten Rechner. Daten basieren auf öffentlich
          verfügbaren Informationen.
        </p>
      </footer>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // FIXME
      $(function () {
        $("#maps-section").load("maps.html");
      });
    </script>

    <script src="TariffClasses.js"></script>
    <script src="VehicleChargingCurves.js"></script>
    <script src="GoogleMapsManager.js"></script>
    <script src="calculator.js"></script>
  </body>
</html>
