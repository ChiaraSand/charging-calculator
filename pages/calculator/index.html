<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>E-Auto Ladekosten Rechner & Tarifvergleich</title>
    <link rel="stylesheet" href="../../css/main.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <header class="header">
        <div class="header-content">
          <h1>
            <i class="fas fa-charging-station"></i> E-Auto Ladekosten Rechner
          </h1>
          <p class="subtitle">
            Vergleiche Ladetarife und finde die günstigsten Ladesäulen in deiner
            Nähe
          </p>
        </div>
      </header>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Preconfiguration Section -->
        <section class="preconfiguration-section">
          <div class="card">
            <div class="card-header">
              <h2><i class="fas fa-cog"></i> Schnellkonfiguration</h2>
              <div class="btn-group">
                <h3>Voreinstellungen</h3>
                <button
                  type="button"
                  id="savePreconfig"
                  class="btn btn-secondary"
                >
                  <i class="fas fa-save"></i> Speichern
                </button>
                <button
                  type="button"
                  id="loadSavedPreconfig"
                  class="btn btn-secondary"
                >
                  <i class="fas fa-save"></i> Laden
                </button>
                <button
                  type="button"
                  id="resetPreconfig"
                  class="btn btn-secondary"
                >
                  <i class="fas fa-trash"></i> Löschen
                </button>
              </div>
              <button
                type="button"
                id="preconfiguration-section-toggle"
                data-toggle-section="preconfiguration-section"
                class="btn btn-secondary section-toggle"
              >
                <i class="fas fa-chevron-up"></i> Ausblenden
              </button>
            </div>
            <div
              class="preconfig-content section-content"
              id="preconfiguration-section-content"
            >
              <div class="preconfig-grid">
                <div class="preconfig-group">
                  <label for="presetSelect"
                    >Vordefinierte Konfigurationen:</label
                  >
                  <select id="presetSelect" name="presetSelect"></select>
                  <small class="form-help"
                    >Ändert Ladestände, Ladeleistung und Tarife</small
                  >
                </div>

                <div class="preconfig-group">
                  <label for="quickVehicleSelect">Fahrzeug:</label>
                  <select
                    id="quickVehicleSelect"
                    name="quickVehicleSelect"
                  ></select>
                  <small class="form-help">Ändert Batteriekapazität</small>
                </div>

                <div class="preconfig-group">
                  <label for="quickChargingPower">Ladeleistung:</label>
                  <select id="quickChargingPower" name="quickChargingPower">
                    <option value="">Ladeleistung wählen...</option>
                    <option value="3.7">AC 3,7 kW (Haushaltssteckdose)</option>
                    <option value="11">AC 11 kW (Wallbox)</option>
                    <option value="22">AC 22 kW (Wallbox)</option>
                    <option value="50">DC 50 kW (Schnelllader)</option>
                    <option value="150">DC 150 kW (Hochleistungslader)</option>
                    <option value="300">DC 300 kW (Ultra-Schnelllader)</option>
                  </select>
                </div>

                <div class="preconfig-group">
                  <label for="quickTariffSelect">Bevorzugte Tarife:</label>
                  <select id="quickTariffSelect" name="quickTariffSelect">
                    <option value="all">Alle Tarife anzeigen</option>
                    <option value="cheapest">Nur günstigste Tarife</option>
                    <option value="premium">
                      Premium Tarife (Ionity, etc.)
                    </option>
                    <option value="local">Lokale Anbieter</option>
                    <option value="custom">Eigene Auswahl</option>
                  </select>
                </div>
              </div>

              <div class="preconfig-actions">
                <button
                  type="button"
                  id="applyPreconfig"
                  class="btn btn-primary"
                >
                  <i class="fas fa-check"></i> Aktualisieren
                </button>
                <!--
                <button
                  type="button"
                  id="savePreconfig"
                  class="btn btn-secondary"
                >
                  <i class="fas fa-save"></i> Speichern
                </button>
                <button
                  type="button"
                  id="loadSavedPreconfig"
                  class="btn btn-secondary"
                >
                  <i class="fas fa-save"></i> Laden
                </button>
                <button
                  type="button"
                  id="resetPreconfig"
                  class="btn btn-secondary"
                >
                  <i class="fas fa-undo"></i> Löschen
                </button>
                -->
              </div>
              <div id="vehicle-details"></div>

              <div class="card filter-section-inline">
                <h3><i class="fas fa-filter"></i> Filter</h3>
                <div class="filter-section-inline-content">
                  <div class="filter-tabs">
                    <button class="filter-tab active" data-tab="providers">
                      <i class="fas fa-building"></i> Anbieter
                    </button>
                    <button class="filter-tab" data-tab="connectors">
                      <i class="fas fa-plug"></i> Steckertypen
                    </button>
                  </div>

                  <!-- Provider Filter Tab -->
                  <div class="filter-content active" id="providers-tab">
                    <div class="provider-filters">
                      <div class="filter-group">
                        <!-- <label>Ladetarife anzeigen:</label> -->
                        <div class="checkbox-grid" id="providerCheckboxes">
                          <!-- Will be populated by JavaScript -->
                        </div>
                      </div>
                      <div class="filter-actions">
                        <button
                          type="button"
                          id="selectAll"
                          class="btn btn-secondary"
                        >
                          Alle auswählen
                        </button>
                        <button
                          type="button"
                          id="selectNone"
                          class="btn btn-secondary"
                        >
                          Alle abwählen
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Connector Filter Tab -->
                <div class="filter-content" id="connectors-tab">
                  <div class="connector-filters">
                    <div class="filter-group">
                      <label>Steckertypen anzeigen:</label>
                      <div class="checkbox-grid" id="connectorCheckboxes">
                        <!-- Will be populated by JavaScript -->
                      </div>
                    </div>
                    <div class="filter-actions">
                      <button
                        type="button"
                        id="selectAllConnectors"
                        class="btn btn-secondary"
                      >
                        Alle auswählen
                      </button>
                      <button
                        type="button"
                        id="selectNoConnectors"
                        class="btn btn-secondary"
                      >
                        Alle abwählen
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Calculator Section -->
        <section class="calculator-section">
          <div class="card">
            <div class="card-header">
              <h2><i class="fas fa-calculator"></i> Ladedauer berechnen</h2>
              <div class="form-actions">
                <!--
                <button type="button" id="clearAll" form="chargingForm" class="btn btn-secondary">
                  <i class="fas fa-eraser"></i> Alle Felder leeren
                </button>
                -->
                <button
                  type="button"
                  id="calculator-section-toggle"
                  data-toggle-section="calculator-section"
                  class="btn btn-secondary section-toggle"
                >
                  <i class="fas fa-chevron-up"></i> Ausblenden
                </button>
              </div>
            </div>

            <div
              class="calculator-form-container section-content"
              id="calculator-section-content"
            >
              <form id="chargingForm" class="calculator-form">
                <div class="form-grid">
                  <!-- <div class="form-group">
                    <label for="vehicleSelect">Fahrzeug-Modell</label>
                    <select id="vehicleSelect" name="vehicleSelect">
                      <option value="renault-5-e-tech-52kwh" selected>
                        Renault 5 E-Tech 52 kWh
                      </option>
                      <option value="generic">Allgemeines Fahrzeug</option>
                    </select>
                    <small class="form-help"
                      >Wählen Sie Ihr Fahrzeug für präzise Ladekurven</small
                    >
                  </div>-->

                  <div class="form-column">
                    <div class="form-group">
                      <label for="currentCharge">Aktueller Ladestand (%)</label>
                      <div class="range-with-clear">
                        <input
                          type="range"
                          id="currentCharge"
                          name="currentCharge"
                          value="20"
                          min="0"
                          max="100"
                          step="1"
                        />
                        <span class="range-value" id="currentChargeValue"
                          >20%</span
                        >
                        <!--
                        <button
                          type="button"
                          class="clear-btn range-clear-btn"
                          data-target="currentCharge"
                          title="Löschen"
                        >
                          <i class="fas fa-times"></i>
                        </button>
                        -->
                      </div>
                    </div>

                    <div class="form-group">
                      <label for="targetCharge">Ziel-Ladestand (%)</label>
                      <div class="range-with-clear">
                        <input
                          type="range"
                          id="targetCharge"
                          name="targetCharge"
                          value="80"
                          min="0"
                          max="100"
                          step="1"
                        />
                        <span class="range-value" id="targetChargeValue"
                          >80%</span
                        >
                        <!--
                        <button
                          type="button"
                          class="clear-btn range-clear-btn"
                          data-target="targetCharge"
                          title="Löschen"
                        >
                          <i class="fas fa-times"></i>
                        </button>
                        -->
                      </div>
                    </div>
                  </div>

                  <div class="form-column">
                    <div class="form-group">
                      <label for="batteryCapacity"
                        >Batteriekapazität (kWh)</label
                      >
                      <div class="input-with-clear">
                        <input
                          type="number"
                          id="batteryCapacity"
                          name="batteryCapacity"
                          value="52"
                          min="1"
                          max="200"
                          step="0.1"
                        />
                        <!--
                        <button
                          type="button"
                          class="clear-btn"
                          data-target="batteryCapacity"
                          title="Löschen"
                        >
                          <i class="fas fa-times"></i>
                        </button>
                        -->
                      </div>
                    </div>

                    <div class="form-group">
                      <label for="chargingPower">Ladeleistung (kW)</label>
                      <select id="chargingPower" name="chargingPower">
                        <option value="3.7">
                          AC 3,7 kW (Haushaltssteckdose)
                        </option>
                        <option value="11">AC 11 kW (Wallbox)</option>
                        <option value="22" selected>AC 22 kW (Wallbox)</option>
                        <option value="50">DC 50 kW (Schnelllader)</option>
                        <option value="150">
                          DC 150 kW (Hochleistungslader)
                        </option>
                        <option value="300">
                          DC 300 kW (Ultra-Schnelllader)
                        </option>
                      </select>
                    </div>
                  </div>

                  <div class="form-column">
                    <div class="form-group">
                      <label for="startTime">Parken Beginn</label>
                      <div class="input-with-clear">
                        <input
                          type="time"
                          id="startTime"
                          name="startTime"
                          value=""
                        />
                        <button
                          type="button"
                          class="clear-btn"
                          data-target="startTime"
                          title="Löschen"
                        >
                          <i class="fas fa-times"></i>
                        </button>
                      </div>
                    </div>

                    <div class="form-group">
                      <label for="endTime">Parken Ende</label>
                      <div class="input-with-clear">
                        <input
                          type="time"
                          id="endTime"
                          name="endTime"
                          value=""
                        />
                        <button
                          type="button"
                          class="clear-btn"
                          data-target="endTime"
                          title="Löschen"
                        >
                          <i class="fas fa-times"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="calculation-summary">
                  <div class="summary-item">
                    <span class="label">Zu ladende Energie:</span>
                    <span class="value" id="energyToCharge"></span>
                  </div>
                  <div class="summary-item">
                    <span class="label">Geschätzte Ladezeit:</span>
                    <span class="value" id="estimatedTime"></span>
                  </div>
                  <div class="summary-item">
                    <span class="label">Gesamte Parkzeit:</span>
                    <span class="value" id="totalParkingTime"></span>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </section>

        <!-- Charging Level Graph Section -->
        <section class="graph-section">
          <div class="card">
            <div class="card-header">
              <h2><i class="fas fa-chart-line"></i> Ladeverlauf</h2>
              <button
                type="button"
                id="graph-section-toggle"
                data-toggle-section="graph-section"
                class="btn btn-secondary section-toggle"
              >
                <i class="fas fa-chevron-up"></i> Ausblenden
              </button>
            </div>
            <div
              class="graph-container section-content"
              id="graph-section-content"
            >
              <div class="graph-info">
                <p class="graph-description">
                  Realistische Darstellung des Ladeverlaufs basierend auf
                  Batteriekapazität und Ladeleistung. Die Grafik zeigt
                  verschiedene Ladeleistungen im Vergleich - von der
                  Haushaltssteckdose bis zum Ultra-Schnelllader.
                </p>
              </div>
              <div class="chart-wrapper">
                <canvas
                  id="chargingLevelChart"
                  width="800"
                  height="400"
                ></canvas>
              </div>
              <div class="graph-legend">
                <div class="legend-header">
                  <h4>Ladekurven anzeigen/ausblenden</h4>
                  <div class="legend-controls">
                    <button
                      type="button"
                      id="showAllCurves"
                      class="btn btn-sm btn-secondary"
                    >
                      <i class="fas fa-eye"></i> Alle anzeigen
                    </button>
                    <button
                      type="button"
                      id="hideAllCurves"
                      class="btn btn-sm btn-secondary"
                    >
                      <i class="fas fa-eye-slash"></i> Alle ausblenden
                    </button>
                  </div>
                </div>
                <div class="legend-items">
                  <div class="legend-item active" data-dataset="0">
                    <div class="legend-color" style="background: #2563eb"></div>
                    <span class="legend-item-text"
                      >Ladeverlauf (realistisch)</span
                    >
                    <button
                      type="button"
                      class="legend-toggle"
                      data-dataset="0"
                    >
                      <i id="legendToggle0-show" class="fas fa-eye"></i>
                      <i id="legendToggle0-hide" class="fas fa-eye-slash"></i>
                    </button>
                  </div>
                  <div class="legend-item active" data-dataset="1">
                    <div class="legend-color" style="background: #10b981"></div>
                    <span class="legend-item-text">Lineare Schätzung</span>
                    <button
                      type="button"
                      class="legend-toggle"
                      data-dataset="1"
                    >
                      <i id="legendToggle1-show" class="fas fa-eye"></i>
                      <i id="legendToggle1-hide" class="fas fa-eye-slash"></i>
                    </button>
                  </div>
                  <div class="legend-item active" data-dataset="2">
                    <div class="legend-color" style="background: #dc2626"></div>
                    <span class="legend-item-text"
                      >400 kW <br /><small class="legend-item-text-sub"
                        >Ultra-Schnelllader</small
                      ></span
                    >
                    <button
                      type="button"
                      class="legend-toggle"
                      data-dataset="2"
                    >
                      <i id="legendToggle2-show" class="fas fa-eye"></i>
                      <i id="legendToggle2-hide" class="fas fa-eye-slash"></i>
                    </button>
                  </div>
                  <div class="legend-item active" data-dataset="3">
                    <div class="legend-color" style="background: #f59e0b"></div>
                    <span class="legend-item-text"
                      >300 kW <br /><small class="legend-item-text-sub"
                        >Hochleistungslader</small
                      ></span
                    >
                    <button
                      type="button"
                      class="legend-toggle"
                      data-dataset="3"
                    >
                      <i id="legendToggle3-show" class="fas fa-eye"></i>
                      <i id="legendToggle3-hide" class="fas fa-eye-slash"></i>
                    </button>
                  </div>
                  <div class="legend-item active" data-dataset="4">
                    <div class="legend-color" style="background: #8b5cf6"></div>
                    <span class="legend-item-text"
                      >150 kW <br /><small class="legend-item-text-sub"
                        >Schnelllader</small
                      ></span
                    >
                    <button
                      type="button"
                      class="legend-toggle"
                      data-dataset="4"
                    >
                      <i id="legendToggle4-show" class="fas fa-eye"></i>
                      <i id="legendToggle4-hide" class="fas fa-eye-slash"></i>
                    </button>
                  </div>
                  <div class="legend-item active" data-dataset="5">
                    <div class="legend-color" style="background: #06b6d4"></div>
                    <span class="legend-item-text"
                      >50 kW <br /><small class="legend-item-text-sub"
                        >DC Schnelllader</small
                      ></span
                    >
                    <button
                      type="button"
                      class="legend-toggle"
                      data-dataset="5"
                    >
                      <i id="legendToggle5-show" class="fas fa-eye"></i>
                      <i id="legendToggle5-hide" class="fas fa-eye-slash"></i>
                    </button>
                  </div>
                  <div class="legend-item active" data-dataset="6">
                    <div class="legend-color" style="background: #84cc16"></div>
                    <span class="legend-item-text"
                      >22 kW <br /><small class="legend-item-text-sub"
                        >AC Wallbox</small
                      ></span
                    >
                    <button
                      type="button"
                      class="legend-toggle"
                      data-dataset="6"
                    >
                      <i id="legendToggle6-show" class="fas fa-eye"></i>
                      <i id="legendToggle6-hide" class="fas fa-eye-slash"></i>
                    </button>
                  </div>
                  <div class="legend-item active" data-dataset="7">
                    <div class="legend-color" style="background: #f97316"></div>
                    <span class="legend-item-text"
                      >11 kW <br /><small class="legend-item-text-sub"
                        >AC Wallbox</small
                      ></span
                    >
                    <button
                      type="button"
                      class="legend-toggle"
                      data-dataset="7"
                    >
                      <i id="legendToggle7-show" class="fas fa-eye"></i>
                      <i id="legendToggle7-hide" class="fas fa-eye-slash"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Tariff Comparison Section -->
        <section class="comparison-section">
          <div class="card">
            <div class="card-header">
              <h2><i class="fas fa-chart-bar"></i> Tarifvergleich</h2>
              <button
                type="button"
                id="comparison-section-toggle"
                data-toggle-section="comparison-section"
                class="btn btn-secondary section-toggle"
              >
                <i class="fas fa-chevron-up"></i> Ausblenden
              </button>
            </div>
            <div
              class="table-container section-content"
              id="comparison-section-content"
            >
              <table id="tariffTable" class="tariff-table">
                <thead>
                  <tr>
                    <th></th>
                    <th colspan="2">Tarif</th>
                    <th colspan="3">Berechnung</th>
                  </tr>
                  <tr>
                    <th>Anbieter</th>
                    <!-- <th>Ladeleistung (kW)</th> -->
                    <th>€/kWh</th>
                    <!-- <th>Grundgebühr</th> -->
                    <th>Blocking Fee (Tarif)</th>
                    <th>
                      Ladekosten Total <br />
                      <small>(<span id="pricePerSelectedKwh">kWh</span>)</small>
                    </th>
                    <th>Blocking Fee Total</th>
                    <th>
                      Gesamtkosten<br /><small class="effective-price"
                        >Effektiv €/kWh</small
                      >
                    </th>
                    <!-- <th>Effektiv €/kWh</th> -->
                  </tr>
                </thead>
                <tbody id="tariffTableBody">
                  <tr>
                    <td colspan="8" class="loading-cell">
                      <i class="fas fa-spinner fa-spin"></i> Lade Tarifdaten...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Map Section -->
        <section id="maps-section"></section>
      </main>

      <!-- Footer -->
      <footer class="footer">
        <p>
          &copy; 2025 E-Auto Ladekosten Rechner. Daten basieren auf öffentlich
          verfügbaren Informationen.
        </p>
      </footer>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script type="module" src="calculator.js"></script>
  </body>
</html>
